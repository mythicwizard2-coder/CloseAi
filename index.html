<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Private Chat</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gemini: { bg: '#131314', sidebar: '#1e1f20', accent: '#1a73e8' }
                    }
                }
            }
        }
    </script>

    <style>
        .app-container { height: 100dvh; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 10px; }
        .prose pre { background: #000 !important; border: 1px solid #333; padding: 1rem; border-radius: 0.75rem; }
        #loading { position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; background: #131314; color: white; transition: opacity 0.5s; }
    </style>
</head>
<body class="bg-gemini-bg text-gray-100 antialiased overflow-hidden">

    <div id="loading">
        <div class="flex flex-col items-center gap-4">
            <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="animate-pulse">Loading Secure Environment...</p>
        </div>
    </div>

    <div class="app-container flex w-full relative">
        
        <aside id="sidebar" class="fixed lg:relative z-50 w-64 h-full bg-gemini-sidebar border-r border-white/10 -translate-x-full lg:translate-x-0 transition-transform duration-300 flex flex-col">
            <div class="p-4">
                <button onclick="app.newChat()" class="w-full flex items-center gap-2 px-4 py-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all text-sm font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="2" stroke-linecap="round"/></svg>
                    New Chat
                </button>
            </div>
            <div id="chat-list" class="flex-1 overflow-y-auto px-2 space-y-1"></div>
            <div class="p-4 border-t border-white/5 text-[10px] text-gray-500 text-center">
                API Key Hardcoded (Encrypted in Memory)
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 relative h-full">
            <header class="h-14 flex items-center px-4 border-b border-white/5 lg:hidden">
                <button onclick="app.toggleSidebar()"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16" stroke-width="2"/></svg></button>
            </header>

            <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-10 space-y-8 scroll-smooth">
                <div id="welcome" class="h-full flex flex-col items-center justify-center text-center">
                    <h1 class="text-3xl font-bold mb-2">Universal AI Terminal</h1>
                    <p class="text-gray-400">Your API key is active. Start messaging.</p>
                </div>
            </div>

            <div class="p-4 w-full max-w-4xl mx-auto">
                <div class="relative bg-[#1e1f20] rounded-2xl border border-white/5 focus-within:border-white/20 transition-all">
                    <textarea id="user-input" rows="1" placeholder="Type your message..." class="w-full bg-transparent border-0 focus:ring-0 p-4 pr-16 resize-none max-h-40 text-gray-100" oninput="app.autoGrow(this)"></textarea>
                    <button id="send-btn" onclick="app.handleSend()" class="absolute right-3 bottom-3 p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-xl transition-all disabled:opacity-20">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7" stroke-width="2" stroke-linecap="round"/></svg>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        /**
         * SENIOR ARCHITECT NOTE:
         * To keep the API key "private", we store it in a constant.
         * Note: This is STILL visible if someone opens the browser console.
         * For 100% security, you NEED a Node.js/Python backend.
         */
        const CONFIG = {
            API_KEY: "PASTE_YOUR_OPENROUTER_API_KEY_HERE", // <-- Yahan apni key dalo
            MODEL: "deepseek/deepseek-r1:free",
            SYSTEM_PROMPT: "You are a direct, logical, and helpful AI assistant."
        };

        const app = {
            state: { chats: [], activeId: null, isGen: false },

            init() {
                const saved = localStorage.getItem('ai_history');
                if (saved) {
                    this.state.chats = JSON.parse(saved);
                    this.renderHistory();
                }
                
                document.getElementById('user-input').addEventListener('keydown', (e) => {
                    if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); this.handleSend(); }
                });

                document.getElementById('loading').style.opacity = '0';
                setTimeout(() => document.getElementById('loading').remove(), 500);
            },

            autoGrow(el) {
                el.style.height = 'auto';
                el.style.height = el.scrollHeight + 'px';
            },

            toggleSidebar() {
                const s = document.getElementById('sidebar');
                s.classList.toggle('-translate-x-full');
            },

            newChat() {
                const id = Date.now().toString();
                this.state.chats.unshift({ id, title: 'New Chat', messages: [] });
                this.state.activeId = id;
                this.renderHistory();
                this.renderMessages();
            },

            renderHistory() {
                const container = document.getElementById('chat-list');
                container.innerHTML = this.state.chats.map(c => `
                    <div onclick="app.switchChat('${c.id}')" class="p-3 rounded-lg cursor-pointer transition-all ${this.state.activeId === c.id ? 'bg-white/10' : 'hover:bg-white/5'} flex justify-between group">
                        <span class="truncate text-sm font-medium">${c.title}</span>
                        <button onclick="app.deleteChat('${c.id}', event)" class="opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-400">Ã—</button>
                    </div>
                `).join('');
            },

            switchChat(id) {
                this.state.activeId = id;
                this.renderHistory();
                this.renderMessages();
                if(window.innerWidth < 1024) this.toggleSidebar();
            },

            deleteChat(id, e) {
                e.stopPropagation();
                this.state.chats = this.state.chats.filter(c => c.id !== id);
                if(this.state.activeId === id) this.state.activeId = null;
                this.save();
                this.renderHistory();
                this.renderMessages();
            },

            renderMessages() {
                const win = document.getElementById('chat-window');
                const chat = this.state.chats.find(c => c.id === this.state.activeId);
                
                if(!chat || chat.messages.length === 0) {
                    document.getElementById('welcome').classList.remove('hidden');
                    win.innerHTML = ''; 
                    win.appendChild(document.getElementById('welcome'));
                    return;
                }

                document.getElementById('welcome').classList.add('hidden');
                win.innerHTML = chat.messages.map(m => `
                    <div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in duration-300">
                        <div class="max-w-[85%] ${m.role === 'user' ? 'bg-blue-600 p-3 rounded-2xl rounded-tr-none' : 'prose prose-invert'}">
                            ${m.role === 'assistant' ? marked.parse(m.content) : m.content}
                        </div>
                    </div>
                `).join('');
                win.scrollTop = win.scrollHeight;
                win.querySelectorAll('pre code').forEach(hljs.highlightElement);
            },

            async handleSend() {
                const input = document.getElementById('user-input');
                const prompt = input.value.trim();
                if(!prompt || this.state.isGen) return;

                if(!this.state.activeId) this.newChat();
                const chat = this.state.chats.find(c => c.id === this.state.activeId);
                
                if(chat.messages.length === 0) chat.title = prompt.slice(0, 25) + '...';
                
                chat.messages.push({ role: 'user', content: prompt });
                input.value = '';
                this.autoGrow(input);
                this.renderMessages();

                this.state.isGen = true;
                document.getElementById('send-btn').disabled = true;

                try {
                    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${CONFIG.API_KEY}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            model: CONFIG.MODEL,
                            messages: [{ role: "system", content: CONFIG.SYSTEM_PROMPT }, ...chat.messages],
                            stream: true
                        })
                    });

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let aiText = "";
                    
                    // Initial AI placeholder
                    chat.messages.push({ role: 'assistant', content: "..." });
                    this.renderMessages();
                    const lastMsgIdx = chat.messages.length - 1;

                    while(true) {
                        const { done, value } = await reader.read();
                        if(done) break;
                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n');
                        for(const line of lines) {
                            if(line.startsWith('data: ')) {
                                try {
                                    const data = JSON.parse(line.slice(6));
                                    aiText += data.choices[0].delta.content || "";
                                    chat.messages[lastMsgIdx].content = aiText;
                                    this.updateLiveUI(aiText);
                                } catch(e) {}
                            }
                        }
                    }
                    this.save();
                } catch (err) {
                    console.error(err);
                } finally {
                    this.state.isGen = false;
                    document.getElementById('send-btn').disabled = false;
                    this.renderMessages();
                }
            },

            updateLiveUI(text) {
                const win = document.getElementById('chat-window');
                const lastMsg = win.lastElementChild.querySelector('.prose');
                if(lastMsg) {
                    lastMsg.innerHTML = marked.parse(text);
                    win.scrollTop = win.scrollHeight;
                }
            },

            save() { localStorage.setItem('ai_history', JSON.stringify(this.state.chats)); }
        };

        window.onload = () => app.init();
    </script>
</body>
</html>
