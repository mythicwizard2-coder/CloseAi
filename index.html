<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Universal AI</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
html, body { height: 100%; }
pre {
  background:#111827;
  color:#f9fafb;
  padding:1rem;
  border-radius:12px;
  overflow:auto;
}
</style>
</head>

<body class="min-h-screen bg-gray-50 dark:bg-[#131314] text-gray-900 dark:text-gray-100">

<div id="loading" class="fixed inset-0 flex items-center justify-center bg-white dark:bg-[#131314] z-50">
  <div class="text-lg font-semibold animate-pulse">Loading App...</div>
</div>

<div id="app" class="hidden flex min-h-screen">

<!-- SIDEBAR -->
<aside id="sidebar"
class="fixed md:relative inset-y-0 left-0 w-72 bg-white dark:bg-[#1e1f20]
border-r border-gray-200 dark:border-gray-800
flex flex-col transform -translate-x-full md:translate-x-0 transition duration-300 z-40">

<div class="p-4 border-b dark:border-gray-800 flex justify-between items-center">
<span class="font-semibold">Chats</span>
<button id="newChat" class="text-blue-600 text-sm">New</button>
</div>

<div id="chatList" class="flex-1 overflow-y-auto"></div>

<div class="p-4 border-t dark:border-gray-800 space-y-2 text-sm">
<button id="toggleTheme" class="w-full text-left">üåô Theme</button>
</div>
</aside>

<!-- MAIN -->
<main class="flex-1 flex flex-col min-h-screen">

<div class="p-4 border-b dark:border-gray-800 bg-white dark:bg-[#1e1f20] flex items-center justify-between">
<button id="mobileToggle" class="md:hidden text-xl">‚ò∞</button>
<h1 id="chatTitle" class="font-semibold">New Chat</h1>
<div></div>
</div>

<div id="messages" class="flex-1 overflow-y-auto p-6 space-y-6 pb-40"></div>

<div class="fixed bottom-0 left-0 md:left-72 right-0
bg-white dark:bg-[#1e1f20]
border-t dark:border-gray-800 p-4">

<div class="flex gap-3 items-end">
<textarea id="input"
class="flex-1 resize-none rounded-2xl border
dark:border-gray-700
p-3 bg-gray-100 dark:bg-[#2a2b2d]
focus:outline-none"
rows="1"
placeholder="Ask anything..."></textarea>

<button id="send"
class="bg-blue-600 hover:bg-blue-700
text-white px-5 py-2 rounded-2xl">Send</button>
</div>

</div>
</main>
</div>

<script>

/* ============================
   HARD CODED CONFIG (VISIBLE)
   ============================ */

const API_KEY = "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";
const MODEL = "arcee-ai/trinity-large-preview:free";

/* ============================ */

let chats = JSON.parse(localStorage.getItem("chats") || "{}");
let currentId = localStorage.getItem("currentId") || null;

/* INIT */

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("loading").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");

  if(localStorage.getItem("theme")==="dark"){
    document.documentElement.classList.add("dark");
  }

  renderChats();
  if(!currentId) createChat();
  else loadChat(currentId);

  attachEvents();
});

/* EVENTS */

function attachEvents(){
  document.getElementById("send").onclick = sendMessage;
  document.getElementById("newChat").onclick = createChat;
  document.getElementById("toggleTheme").onclick = toggleTheme;
  document.getElementById("mobileToggle").onclick = () =>
    document.getElementById("sidebar").classList.toggle("-translate-x-full");
}

/* CHAT MANAGEMENT */

function createChat(){
  const id = Date.now().toString();
  chats[id] = { title:"New Chat", messages:[], system:"" };
  currentId=id;
  saveState();
  renderChats();
  loadChat(id);
}

function loadChat(id){
  if(!chats[id]) return;
  currentId=id;
  document.getElementById("chatTitle").textContent = chats[id].title;
  renderMessages();
}

function deleteChat(id){
  delete chats[id];
  currentId=null;
  saveState();
  renderChats();
  createChat();
}

function renameChat(id){
  const name = prompt("Rename chat:");
  if(!name) return;
  chats[id].title = name;
  saveState();
  renderChats();
}

function renderChats(){
  const list = document.getElementById("chatList");
  list.innerHTML="";
  Object.keys(chats).forEach(id=>{
    const div=document.createElement("div");
    div.className="p-3 hover:bg-gray-100 dark:hover:bg-[#2a2b2d] cursor-pointer group";
    div.innerHTML=`
      <div class="flex justify-between items-center">
        <span>${chats[id].title}</span>
        <div class="hidden group-hover:flex gap-2 text-xs">
          <button onclick="renameChat('${id}')">‚úè</button>
          <button onclick="deleteChat('${id}')">üóë</button>
        </div>
      </div>`;
    div.onclick=()=>loadChat(id);
    list.appendChild(div);
  });
}

/* RENDER MESSAGES */

function renderMessages(){
  const container=document.getElementById("messages");
  container.innerHTML="";
  const chat=chats[currentId];
  if(!chat) return;

  chat.messages.forEach(msg=>{
    const div=document.createElement("div");
    div.className=msg.role==="user"?"text-right":"text-left";

    div.innerHTML=`
    <div class="inline-block max-w-[85%] p-4 rounded-2xl
    ${msg.role==="user"
      ?"bg-blue-600 text-white"
      :"bg-gray-200 dark:bg-[#2a2b2d]"}">
    ${marked.parse(msg.content)}
    </div>`;
    container.appendChild(div);
  });

  container.scrollTop=container.scrollHeight;
}

/* SEND + STREAM */

async function sendMessage(){
  const input=document.getElementById("input");
  const text=input.value.trim();
  if(!text) return;

  input.value="";

  const chat=chats[currentId];
  chat.messages.push({role:"user",content:text});
  renderMessages();
  saveState();

  const ai={role:"assistant",content:""};
  chat.messages.push(ai);
  renderMessages();

  try{
    const res=await fetch("https://openrouter.ai/api/v1/chat/completions",{
      method:"POST",
      headers:{
        "Authorization":"Bearer "+API_KEY,
        "Content-Type":"application/json"
      },
      body:JSON.stringify({
        model:MODEL,
        messages:chat.messages,
        stream:true
      })
    });

    const reader=res.body.getReader();
    const decoder=new TextDecoder("utf-8");

    while(true){
      const {done,value}=await reader.read();
      if(done) break;
      const chunk=decoder.decode(value);
      const lines=chunk.split("\n").filter(l=>l.startsWith("data: "));
      for(const line of lines){
        const json=line.replace("data: ","").trim();
        if(json==="[DONE]") return;
        const data=JSON.parse(json);
        const token=data.choices?.[0]?.delta?.content;
        if(token){
          ai.content+=token;
          renderMessages();
        }
      }
    }
    saveState();
  }catch(e){
    ai.content="Error: "+e.message;
    renderMessages();
  }
}

/* THEME */

function toggleTheme(){
  document.documentElement.classList.toggle("dark");
  localStorage.setItem("theme",
  document.documentElement.classList.contains("dark")?"dark":"light");
}

/* SAVE */

function saveState(){
  localStorage.setItem("chats",JSON.stringify(chats));
  localStorage.setItem("currentId",currentId);
}

</script>
</body>
    </html>
