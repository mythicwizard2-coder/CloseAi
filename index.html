<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>NeuroPurple AI</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
html,body{height:100%}

.glow{
  box-shadow:0 0 20px rgba(168,85,247,.6);
}

.fade-in{
  animation:fade .25s ease-in-out;
}

@keyframes fade{
  from{opacity:0;transform:translateY(6px)}
  to{opacity:1;transform:translateY(0)}
}

pre{
  background:#0f0f1a;
  padding:1rem;
  border-radius:14px;
  overflow:auto;
  position:relative;
}

.copy-btn{
  position:absolute;
  top:8px;
  right:8px;
  background:#7c3aed;
  color:white;
  font-size:12px;
  padding:4px 8px;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-[#0d061a] via-[#140f25] to-[#1b1033] text-white">

<div id="loading" class="fixed inset-0 flex items-center justify-center bg-[#0d061a] z-50">
  <div class="text-lg animate-pulse text-purple-400">Loading AI...</div>
</div>

<div id="app" class="hidden flex min-h-screen">

<!-- SIDEBAR -->
<aside id="sidebar"
class="fixed md:relative inset-y-0 left-0 w-72 bg-[#151022] border-r border-purple-900 flex flex-col transform -translate-x-full md:translate-x-0 transition duration-300 z-40">

<div class="p-4 text-xl font-semibold text-purple-400">NeuroPurple</div>

<button onclick="createChat()" class="m-4 p-2 bg-purple-700 rounded-lg glow">
+ New Chat
</button>

<div id="chatList" class="flex-1 overflow-y-auto"></div>

</aside>

<!-- MAIN -->
<main class="flex-1 flex flex-col min-h-screen">

<!-- HEADER -->
<div class="p-4 border-b border-purple-900 flex justify-between items-center">
<button onclick="toggleSidebar()" class="md:hidden text-xl">â˜°</button>

<select id="modelSelect"
class="bg-[#1e1530] p-2 rounded-lg glow text-sm">
<option>arcee-ai/trinity-large-preview:free</option>
<option>deepseek/deepseek-r1:free</option>
<option>mistralai/mixtral-8x7b</option>
</select>
</div>

<!-- MESSAGES -->
<div id="messages"
class="flex-1 overflow-y-auto p-6 space-y-6 pb-40"></div>

<!-- INPUT -->
<div class="fixed bottom-0 left-0 md:left-72 right-0 bg-[#140f25] border-t border-purple-900 p-4">
<div class="flex gap-3 items-end">
<textarea id="input"
rows="1"
class="flex-1 resize-none bg-[#1e1530] p-3 rounded-xl focus:outline-none glow"
placeholder="Ask anything..."></textarea>
<button onclick="sendMessage()"
class="bg-purple-700 px-6 py-2 rounded-xl glow">
Send
</button>
</div>
</div>

</main>
</div>

<script>

/* ===== CONFIG (VISIBLE) ===== */

const API_KEY = "PASTE_YOUR_KEY_HERE";

/* ===== STATE ===== */

let chats = JSON.parse(localStorage.getItem("chats") || "{}");
let currentId = localStorage.getItem("currentId") || null;
let savedModel = localStorage.getItem("model") || "arcee-ai/trinity-large-preview:free";

/* ===== INIT ===== */

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("loading").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");

  document.getElementById("modelSelect").value = savedModel;

  if(!currentId) createChat();
  else loadChat(currentId);

  renderChats();
});

/* ===== CHAT MANAGEMENT ===== */

function createChat(){
  const id=Date.now().toString();
  chats[id]={title:"New Chat",messages:[]};
  currentId=id;
  saveState();
  renderChats();
  loadChat(id);
}

function loadChat(id){
  currentId=id;
  renderMessages();
}

function renderChats(){
  const list=document.getElementById("chatList");
  list.innerHTML="";
  Object.keys(chats).forEach(id=>{
    const div=document.createElement("div");
    div.className="p-3 hover:bg-purple-800 cursor-pointer";
    div.innerText=chats[id].title;
    div.onclick=()=>loadChat(id);
    list.appendChild(div);
  });
}

function renderMessages(){
  const container=document.getElementById("messages");
  container.innerHTML="";
  chats[currentId].messages.forEach(msg=>{
    const div=document.createElement("div");
    div.className="fade-in";
    div.innerHTML=`
      <div class="max-w-[80%] p-4 rounded-xl ${
        msg.role==="user"?"bg-purple-700 ml-auto":"bg-[#1e1530]"
      }">
      ${marked.parse(msg.content)}
      </div>`;
    container.appendChild(div);
  });
  addCopyButtons();
  container.scrollTop=container.scrollHeight;
}

function saveState(){
  localStorage.setItem("chats",JSON.stringify(chats));
  localStorage.setItem("currentId",currentId);
}

/* ===== COPY BUTTON ===== */

function addCopyButtons(){
  document.querySelectorAll("pre").forEach(pre=>{
    if(pre.querySelector(".copy-btn")) return;
    const btn=document.createElement("button");
    btn.innerText="Copy";
    btn.className="copy-btn";
    btn.onclick=()=>{
      navigator.clipboard.writeText(pre.innerText);
      btn.innerText="Copied!";
      setTimeout(()=>btn.innerText="Copy",1000);
    };
    pre.appendChild(btn);
  });
}

/* ===== SEND + STREAM ===== */

async function sendMessage(){
  const input=document.getElementById("input");
  const text=input.value.trim();
  if(!text) return;

  input.value="";

  const chat=chats[currentId];
  chat.messages.push({role:"user",content:text});
  renderMessages();
  saveState();

  const ai={role:"assistant",content:""};
  chat.messages.push(ai);
  renderMessages();

  const model=document.getElementById("modelSelect").value;
  localStorage.setItem("model",model);

  const res=await fetch("https://openrouter.ai/api/v1/chat/completions",{
    method:"POST",
    headers:{
      "Authorization":"Bearer "+API_KEY,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      model,
      messages:chat.messages,
      stream:true
    })
  });

  const reader=res.body.getReader();
  const decoder=new TextDecoder();

  while(true){
    const {done,value}=await reader.read();
    if(done) break;
    const chunk=decoder.decode(value);
    const lines=chunk.split("\n").filter(l=>l.startsWith("data: "));
    for(const line of lines){
      const json=line.replace("data: ","");
      if(json==="[DONE]") return;
      const data=JSON.parse(json);
      const token=data.choices?.[0]?.delta?.content;
      if(token){
        ai.content+=token;
        renderMessages();
      }
    }
  }

  saveState();
}

/* ===== UI ===== */

function toggleSidebar(){
  document.getElementById("sidebar").classList.toggle("-translate-x-full");
}

</script>
</body>
  </html>
